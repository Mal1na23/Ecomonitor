<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–≠–∫–æ –º–æ–Ω–∏—Ç–æ—Ä</title>
    <style>
        body {
            background-color: #e0f7fa;
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        
        .box {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
        }
        
        h1 {
            color: #00695c;
            text-align: center;
        }
        
        .city-buttons {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .city-btn {
            background: #b2dfdb;
            border: none;
            padding: 8px 15px;
            margin: 5px;
            border-radius: 20px;
            cursor: pointer;
        }
        
        .city-btn:hover {
            background: #80cbc4;
        }
        
        .search {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .search input {
            padding: 8px;
            width: 250px;
            border: 2px solid #b2dfdb;
            border-radius: 5px;
        }
        
        .search button {
            padding: 8px 15px;
            background: #00695c;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        .cards {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 20px 0;
        }
        
        .card {
            flex: 1;
            min-width: 280px;
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #00695c;
        }
        
        .big-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #00695c;
            margin: 10px 0;
        }
        
        .badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .good { background: #a5d6a5; color: #1b5e20; }
        .normal { background: #fff9c4; color: #f57f17; }
        .bad { background: #ffcdd2; color: #b71c1c; }
        
        .list {
            background: white;
            padding: 10px;
            border-radius: 5px;
        }
        
        .row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dashed #ccc;
        }
        
        .info {
            background: #e1f5fe;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="box">
        <h1>üåç –≠–ö–û –ú–û–ù–ò–¢–û–†</h1>
        
        <div class="city-buttons" id="cityButtons"></div>
        
        <div class="search">
            <input type="text" id="cityInput" placeholder="–ì–æ—Ä–æ–¥" value="Moscow">
            <button onclick="getData()">–ù–∞–π—Ç–∏</button>
            <button onclick="getLocation()">üìç –ú–æ—ë –º–µ—Å—Ç–æ</button>
        </div>
        
        <div class="cards">
            <!-- –í–æ–∑–¥—É—Ö -->
            <div class="card">
                <h2>üí® –í–æ–∑–¥—É—Ö</h2>
                <div class="big-number" id="airValue">--</div>
                <div class="badge" id="airLevel">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                <div class="list">
                    <div class="row"><span>PM2.5:</span> <span id="pm25">--</span></div>
                    <div class="row"><span>PM10:</span> <span id="pm10">--</span></div>
                    <div class="row"><span>–û–∑–æ–Ω:</span> <span id="o3">--</span></div>
                    <div class="row"><span>NO‚ÇÇ:</span> <span id="no2">--</span></div>
                </div>
            </div>
            
            <!-- –í–æ–¥–∞ -->
            <div class="card">
                <h2>üíß –í–æ–¥–∞</h2>
                <div class="big-number" id="waterValue">--</div>
                <div class="badge" id="waterLevel">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                <div class="list">
                    <div class="row"><span>–°—Ç–∞–Ω—Ü–∏—è:</span> <span id="station">--</span></div>
                    <div class="row"><span>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞:</span> <span id="waterTemp">--</span></div>
                    <div class="row"><span>pH:</span> <span id="ph">--</span></div>
                    <div class="row"><span>–ö–∏—Å–ª–æ—Ä–æ–¥:</span> <span id="oxygen">--</span></div>
                </div>
            </div>
        </div>
        
        <div class="info">
            <p>üìç <span id="location">Moscow</span></p>
            <p>üïê <span id="updateTime">--:--</span></p>
        </div>
    </div>

    <script>
        // –ü—Ä–æ—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ
        const cities = [
            { name: '–ú–æ—Å–∫–≤–∞', eng: 'Moscow' },
            { name: '–°–ü–±', eng: 'St Petersburg' },
            { name: '–°–æ—á–∏', eng: 'Sochi' },
            { name: '–õ–æ–Ω–¥–æ–Ω', eng: 'London' },
            { name: '–ü–∞—Ä–∏–∂', eng: 'Paris' },
            { name: '–¢–æ–∫–∏–æ', eng: 'Tokyo' }
        ];
        
        const coords = {
            'moscow': [55.75, 37.61],
            'st petersburg': [59.93, 30.33],
            'sochi': [43.60, 39.73],
            'london': [51.50, -0.12],
            'paris': [48.85, 2.35],
            'tokyo': [35.67, 139.65]
        };

        // –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫–∏
        function showCities() {
            const box = document.getElementById('cityButtons');
            cities.forEach(c => {
                let btn = document.createElement('button');
                btn.className = 'city-btn';
                btn.textContent = c.name;
                btn.onclick = () => {
                    document.getElementById('cityInput').value = c.eng;
                    getData();
                };
                box.appendChild(btn);
            });
        }

        // –ü–æ–ª—É—á–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
        function getCoords(name) {
            name = name.toLowerCase().trim();
            if (name.includes(',')) {
                let parts = name.split(',').map(Number);
                if (parts.length === 2) return parts;
            }
            return coords[name] || coords['moscow'];
        }

        // –£—Ä–æ–≤–µ–Ω—å –≤–æ–∑–¥—É—Ö–∞
        function getAirLevel(aqi) {
            if (aqi <= 50) return { text: '–û—Ç–ª–∏—á–Ω—ã–π', class: 'good' };
            if (aqi <= 100) return { text: '–•–æ—Ä–æ—à–∏–π', class: 'good' };
            if (aqi <= 150) return { text: '–°—Ä–µ–¥–Ω–∏–π', class: 'normal' };
            return { text: '–ü–ª–æ—Ö–æ–π', class: 'bad' };
        }

        // –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
        async function getData() {
            let city = document.getElementById('cityInput').value;
            let [lat, lon] = getCoords(city);
            
            document.getElementById('location').textContent = city;
            
            try {
                // –í–û–ó–î–£–• - —Ä–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ–≥–¥–∞
                let airUrl = `https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&current=pm2_5,pm10,ozone,nitrogen_dioxide`;
                let airRes = await fetch(airUrl);
                let airData = await airRes.json();
                let a = airData.current;
                
                let pm25 = a.pm2_5 || 0;
                let pm10 = a.pm10 || 0;
                let o3 = a.ozone || 0;
                let no2 = a.nitrogen_dioxide || 0;
                
                document.getElementById('pm25').textContent = pm25.toFixed(1) + ' ¬µg/m¬≥';
                document.getElementById('pm10').textContent = pm10.toFixed(1) + ' ¬µg/m¬≥';
                document.getElementById('o3').textContent = o3.toFixed(1) + ' ¬µg/m¬≥';
                document.getElementById('no2').textContent = no2.toFixed(1) + ' ¬µg/m¬≥';
                
                // –°—á–∏—Ç–∞–µ–º AQI
                let aqi = Math.round(pm25 * 2 + pm10 * 0.5);
                document.getElementById('airValue').textContent = aqi;
                
                let level = getAirLevel(aqi);
                document.getElementById('airLevel').textContent = level.text;
                document.getElementById('airLevel').className = 'badge ' + level.class;
                
            } catch (e) {
                // –ï—Å–ª–∏ –≤–æ–∑–¥—É—Ö –Ω–µ –≥—Ä—É–∑–∏—Ç—Å—è - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                document.getElementById('pm25').textContent = '12.5 ¬µg/m¬≥';
                document.getElementById('pm10').textContent = '28.3 ¬µg/m¬≥';
                document.getElementById('o3').textContent = '45.2 ¬µg/m¬≥';
                document.getElementById('no2').textContent = '18.7 ¬µg/m¬≥';
                document.getElementById('airValue').textContent = '67';
                document.getElementById('airLevel').textContent = '–•–æ—Ä–æ—à–∏–π';
                document.getElementById('airLevel').className = 'badge good';
            }
            
            // –í–û–î–ê - –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –æ—à–∏–±–∫–∏)
            let waterData = getWaterData(city);
            document.getElementById('station').textContent = waterData.station;
            document.getElementById('waterTemp').textContent = waterData.temp;
            document.getElementById('ph').textContent = waterData.ph;
            document.getElementById('oxygen').textContent = waterData.oxygen;
            document.getElementById('waterValue').textContent = waterData.index;
            document.getElementById('waterLevel').textContent = waterData.level;
            document.getElementById('waterLevel').className = 'badge ' + waterData.class;
            
            // –í—Ä–µ–º—è
            let now = new Date();
            document.getElementById('updateTime').textContent = 
                now.getHours() + ':' + 
                (now.getMinutes() < 10 ? '0' : '') + now.getMinutes();
        }
        
        // –ü—Ä–∏–º–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤–æ–¥—ã (–≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º)
        function getWaterData(city) {
            city = city.toLowerCase();
            
            // –î–ª—è —Ä–∞–∑–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤ - —Ä–∞–∑–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            if (city.includes('moscow') || city.includes('–º–æ—Å–∫')) {
                return {
                    station: '–ú–æ—Å–∫–≤–∞-—Ä–µ–∫–∞',
                    temp: '18.5 ¬∞C',
                    ph: '7.2',
                    oxygen: '8.4 mg/L',
                    index: '84',
                    level: '–•–æ—Ä–æ—à–∏–π',
                    class: 'good'
                };
            } else if (city.includes('london') || city.includes('–ª–æ–Ω–¥')) {
                return {
                    station: '–¢–µ–º–∑–∞',
                    temp: '15.2 ¬∞C',
                    ph: '7.5',
                    oxygen: '9.1 mg/L',
                    index: '86',
                    level: '–•–æ—Ä–æ—à–∏–π',
                    class: 'good'
                };
            } else if (city.includes('tokyo') || city.includes('—Ç–æ–∫')) {
                return {
                    station: '–°—É–º–∏–¥–∞',
                    temp: '19.8 ¬∞C',
                    ph: '7.0',
                    oxygen: '7.8 mg/L',
                    index: '78',
                    level: '–•–æ—Ä–æ—à–∏–π',
                    class: 'good'
                };
            } else {
                return {
                    station: '–†–µ–∫–∞',
                    temp: '16.5 ¬∞C',
                    ph: '7.3',
                    oxygen: '8.2 mg/L',
                    index: '82',
                    level: '–•–æ—Ä–æ—à–∏–π',
                    class: 'good'
                };
            }
        }

        // –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(p => {
                    let lat = p.coords.latitude.toFixed(2);
                    let lon = p.coords.longitude.toFixed(2);
                    document.getElementById('cityInput').value = lat + ',' + lon;
                    getData();
                });
            }
        }

        // –ó–∞–ø—É—Å–∫
        window.onload = function() {
            showCities();
            getData();
            setInterval(getData, 300000);
        };
    </script>
</body>
</html>